TOKEN=8139355615:AAFSs09vi_SwiOw0uuFpWfb9lHlXwc5_4bM
DB_LITE=sqlite+aiosqlite:///my_base.db
ADMINS_LIST=435946390,2313213,1515846525,6266217488

TOKEN=8289872442:AAFzX6BfHdBaXvltFVV1bBkKHKSdb-sXUkQ
DB_LITE=sqlite+aiosqlite:///my_base.db
ADMINS_LIST=435946390

‚úÖ –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ scrap_everything –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è:

async def scrap_everything(bot, notify: bool):
    ...


–ò —Ç–æ–≥–¥–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–¥–æ —Ç–∞–∫:

scheduler.add_job(
    scrap_everything,
    trigger=CronTrigger(hour=9, minute=0),
    args=(bot, True),
    coalesce=True,   # —Å–ª–∏–≤–∞–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
    misfire_grace_time=60  # –µ—Å–ª–∏ –ø—Ä–æ–ø—É—Å—Ç–∏–ª, –¥–∞–µ—Ç –º–∏–Ω—É—Ç—É –Ω–∞ –∑–∞–ø—É—Å–∫
)


‚ö†Ô∏è –ï—Å–ª–∏ scrap_everything –≤–Ω—É—Ç—Ä–∏ –≤—ã–∑—ã–≤–∞–µ—Ç –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, requests.get –∏–ª–∏ –ø–∞—Ä—Å–µ—Ä —Å os.system), –∏—Ö –Ω–∞–¥–æ –≤—ã–Ω–µ—Å—Ç–∏ –≤ asyncio.to_thread() –∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∞–Ω–∞–ª–æ–≥–∏.

–ó–∞–º–µ–Ω–∏ time.sleep(1) –Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π await asyncio.sleep(1):

except Exception as e:
    logger.error(f"–û—à–∏–±–∫–∞ –≤ polling: {e}", exc_info=True)
    await asyncio.sleep(1)


–ï—Å–ª–∏ –≥–¥–µ-—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å subprocess.Popen, –∏—Å–ø—Ä–∞–≤—å —Ç–∞–∫:

import asyncio

proc = await asyncio.create_subprocess_exec(
    "python", "parser.py",
    stdout=asyncio.subprocess.PIPE,
    stderr=asyncio.subprocess.PIPE
)
stdout, stderr = await proc.communicate()


–¢–æ–≥–¥–∞ –ø—Ä–æ—Ü–µ—Å—Å –¥–æ—á–∏—Å—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

üîß –î–æ–ø. –æ—Ç–ª–∞–¥–∫–∞

–ú–æ–∂–µ—à—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å, –∫—Ç–æ –∏–º–µ–Ω–Ω–æ –ø–ª–æ–¥–∏—Ç –∑–æ–º–±–∏:

ps -eo pid,ppid,stat,cmd | grep Z


–í –∫–æ–ª–æ–Ω–∫–µ PPID –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ, –∫–∞–∫–æ–π –ø—Ä–æ—Ü–µ—Å—Å (–æ–±—ã—á–Ω–æ Python) –∏—Ö –¥–µ—Ä–∂–∏—Ç. –ï—Å–ª–∏ —ç—Ç–æ —Ç–≤–æ–π bot.py, –∑–Ω–∞—á–∏—Ç –≤–∏–Ω–æ–≤–∞—Ç APScheduler/–ø–∞—Ä—Å–µ—Ä.

üëâ –•–æ—á–µ—à—å, —è –ø–µ—Ä–µ–ø–∏—à—É –∫—É—Å–æ–∫ —Å scrap_everything –∏ time.sleep, —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —É–±—Ä–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ –∑–æ–º–±–∏?